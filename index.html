<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>可愛注音練習</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="注音練習">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<style>
    body {
        margin: 0;
        padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        font-family: "Helvetica Neue", sans-serif;
        background: #f8f9ff;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
    }

    /* 上方注音顯示區 */
    #displayArea {
        text-align: center;
        font-size: 40px;
        padding: 20px;
        height: 120px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    #bopomofoOutput {
        font-size: 42px;
        margin-bottom: 10px;
    }
    #candidateArea {
        font-size: 30px;
        flex-wrap: wrap;
        display: flex;
        justify-content: center;
        gap: 10px;
    }
    .candidate {
        padding: 6px 14px;
        border-radius: 12px;
        background: rgba(255,255,255,0.7);
        backdrop-filter: blur(12px);
        cursor: pointer;
        font-size: 30px;
    }
    .candidate:active {
        transform: scale(0.92);
    }

    /* 按鍵 */
    .keyboard {
        flex: 1;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        padding: 10px;
        overflow-y: auto;
    }

    .keyboard button {
        width: 65px;
        height: 65px;
        margin: 6px;
        font-size: 28px;
        border-radius: 16px;
        border: 1px solid rgba(255,255,255,0.4);
        backdrop-filter: blur(14px);
        background: rgba(255,255,255,0.45);
        cursor: pointer;
        transition: 0.15s;
    }

    .keyboard button:active {
        transform: scale(0.88);
        background: rgba(255,255,255,0.7);
    }

    .function-key {
        background: rgba(255,180,200,0.5);
    }

</style>
</head>
<body>

<div id="displayArea">
    <div id="bopomofoOutput"></div>
    <div id="candidateArea"></div>
</div>

<!-- ===== 鍵盤（第一版） ===== -->
<div class="keyboard" id="keyboard">
    <!-- 第 1 列 -->
    <button>ㄅ</button><button>ㄆ</button><button>ㄇ</button><button>ㄈ</button>
    <button>ㄉ</button><button>ㄊ</button><button>ㄋ</button><button>ㄌ</button>

    <!-- 第 2 列 -->
    <button>ㄍ</button><button>ㄎ</button><button>ㄏ</button><button>ㄐ</button>
    <button>ㄑ</button><button>ㄒ</button><button>ㄓ</button><button>ㄔ</button>
    <button>ㄕ</button><button>ㄖ</button>

    <!-- 第 3 列 -->
    <button>ㄗ</button><button>ㄘ</button><button>ㄙ</button>
    <button>ㄧ</button><button>ㄨ</button><button>ㄩ</button>

    <!-- 第 4 列（韻母） -->
    <button>ㄚ</button><button>ㄛ</button><button>ㄜ</button><button>ㄝ</button>
    <button>ㄞ</button><button>ㄟ</button><button>ㄠ</button><button>ㄡ</button>
    <button>ㄢ</button><button>ㄣ</button><button>ㄤ</button><button>ㄥ</button>
    <button>ㄦ</button>

    <!-- 功能鍵 -->
    <button id="clearKey" class="function-key">清除</button>
    <button id="readKey" class="function-key">讀音</button>
</div>

<script>
/* ==========================
   注音 → 發音示例（正確版）
   ========================== */
const sampleMap = {
  'ㄅ':'波','ㄆ':'坡','ㄇ':'摸','ㄈ':'ㄈ',
  'ㄉ':'ㄉ','ㄊ':'ㄊ','ㄋ':'ㄋ','ㄌ':'ㄌ',
  'ㄍ':'哥','ㄎ':'科','ㄏ':'喝','ㄐ':'雞',
  'ㄑ':'七','ㄒ':'西', /* 修正 */
  'ㄓ':'之','ㄔ':'吃','ㄕ':'是','ㄖ':'日',
  'ㄗ':'資','ㄘ':'ㄘ','ㄙ':'思',
  'ㄧ':'伊', /* 修正 */
  'ㄨ':'屋','ㄩ':'瘀',
  'ㄚ':'阿','ㄛ':'喔','ㄜ':'鵝','ㄝ':'耶',
  'ㄞ':'愛','ㄟ':'欸','ㄠ':'凹','ㄡ':'歐',
  'ㄢ':'安','ㄣ':'恩','ㄤ':'昂','ㄥ':'ㄥ','ㄦ':'兒'
};

/* ==========================
   注音 → 國字（示例字庫）
   （你之後可替換完整 JSON）
   ========================== */
const dictionary = {
  "ㄅㄚ": ["吧","八","爸","拔"],
  "ㄅㄞ": ["白","百","拜"],
  "ㄅㄠ": ["包","胞","寶"],
  "ㄧ": ["一","伊","依"],
  "ㄒㄧ": ["希","喜","希"],
  "ㄧㄥ": ["英","應","嬰"]
};

/* ==========================
   狀態
   ========================== */
let bopomofo = "";

/* ==========================
   DOM
   ========================== */
const output = document.getElementById("bopomofoOutput");
const candidateArea = document.getElementById("candidateArea");

/* ==========================
   語音功能
   ========================== */
function speak(text) {
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "zh-TW";
    speechSynthesis.speak(utter);
}

/* ==========================
   更新候選字
   ========================== */
function updateCandidates() {
    candidateArea.innerHTML = "";

    if (dictionary[bopomofo]) {
        dictionary[bopomofo].forEach(c => {
            const btn = document.createElement("div");
            btn.className = "candidate";
            btn.textContent = c;
            btn.onclick = () => {
                output.textContent = c;
                bopomofo = "";
                candidateArea.innerHTML = "";
            };
            candidateArea.appendChild(btn);
        });
    }
}

/* ==========================
   鍵盤按下
   ========================== */
document.getElementById("keyboard").addEventListener("click", e => {
    if (e.target.tagName !== "BUTTON") return;

    const key = e.target.textContent;

    if (key === "清除") {
        bopomofo = "";
        output.textContent = "";
        candidateArea.innerHTML = "";
        return;
    }

    if (key === "讀音") {
        if (output.textContent !== "") speak(output.textContent);
        return;
    }

    // 添加注音
    bopomofo += key;
    output.textContent = bopomofo;

    // 唸按鍵（清除語音已關閉）
    if (sampleMap[key]) speak(sampleMap[key]);

    updateCandidates();
});

</script>

</body>
</html>