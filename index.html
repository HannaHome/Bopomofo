<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注音輸入鍵盤 PWA</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">

    <style>
        body {
            margin: 0;
            padding: 0;
            background: #fafafa;
            font-family: system-ui, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        #output {
            padding: 20px;
            font-size: 32px;
            background: white;
            border-bottom: 1px solid #eee;
            min-height: 80px;
        }

        .keyboard {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
            padding: 12px;
            background: #fff;
            margin-top: auto;
            border-top: 1px solid #ddd;
        }

        .key {
            padding: 16px 0;
            background: #f1f1f1;
            border-radius: 10px;
            text-align: center;
            font-size: 22px;
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s, background 0.1s;
        }

        .key:active {
            transform: scale(0.92);
            background: #e1e1e1;
        }

        .action {
            background: #e8f2ff;
        }
    </style>
</head>

<body>

<div id="output"></div>

<!-- 注音鍵盤（第一版完整排列） -->
<div class="keyboard" id="keyboard"></div>

<script>
// ------------------------------
// 注音符號鍵盤（第一版）
// ------------------------------
const bopomofoKeys = [
    "ㄅ","ㄆ","ㄇ","ㄈ","ㄉ","ㄊ","ㄋ","ㄌ","ㄍ","ㄎ",
    "ㄏ","ㄐ","ㄑ","ㄒ","ㄓ","ㄔ","ㄕ","ㄖ","ㄗ","ㄘ",
    "ㄙ","ㄚ","ㄛ","ㄜ","ㄝ","ㄞ","ㄟ","ㄠ","ㄡ","ㄢ",
    "ㄣ","ㄤ","ㄥ","ㄦ","ㄧ","ㄨ","ㄩ",
    "刪除","清空","組字"
];

const output = document.getElementById("output");
const keyboard = document.getElementById("keyboard");

// 動態建立鍵盤
bopomofoKeys.forEach(k => {
    const btn = document.createElement("div");
    btn.className = "key" + (["刪除","清空","組字"].includes(k) ? " action" : "");
    btn.textContent = k;
    btn.onclick = () => handleKey(k);
    keyboard.appendChild(btn);
});

let buffer = "";

// 中文語音
function speak(text) {
    const utt = new SpeechSynthesisUtterance(text);
    utt.lang = "zh-TW";
    speechSynthesis.speak(utt);
}

// 注音 → 國字（超迷你示範，你之後可換成大字庫 JSON）
const map = {
    "ㄋㄧ": "你",
    "ㄨㄛˇ": "我",
    "ㄓㄜˋ": "這",
};

// 處理按鍵事件
function handleKey(k) {
    if (k === "刪除") {
        buffer = buffer.slice(0, -1);
        output.textContent = buffer;
        speak("刪除");
        return;
    }

    if (k === "清空") {
        buffer = "";
        output.textContent = buffer;
        speak("清空");
        return;
    }

    if (k === "組字") {
        const word = map[buffer] || "(無對應)";
        output.textContent = word;
        speak("等於 " + word);
        buffer = "";
        return;
    }

    buffer += k;
    output.textContent = buffer;
    speak(k);
}

// ------------------------------
// Service Worker 註冊
// ------------------------------
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>